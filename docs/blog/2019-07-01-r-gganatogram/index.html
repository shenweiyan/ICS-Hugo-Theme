<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"> 
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"> 
    <link rel="stylesheet" href="../../fonts/academicons-1.8.6/css/academicons.min.css"/>
    <link rel="icon" type="image/png" sizes="32x32" href="../../img/logo.png"> 
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    
    
    
    
    <title>基于 ggplot2 的解剖图和组织模块可视化 - Steven Shen | 沈维燕</title> 
    <meta property="og:title" content="基于 ggplot2 的解剖图和组织模块可视化 - Steven Shen | 沈维燕">
    

    
      
    

    

    
  
    <link rel="stylesheet" href="https://ivc.bioinit.com/css/style.css"/>
    <link rel="stylesheet" href="https://ivc.bioinit.com/css/fonts.css"/>
    <script async src="https://ivc.bioinit.com/js/load-typekit.js"></script>

<link rel="stylesheet" href="https://ivc.bioinit.com/css/template-styles.css" />
<link rel="stylesheet" href="https://ivc.bioinit.com/css/custom.css" />

  </head>

  
  <body class="blog">
    
    
    <header class="intro-and-nav" role="banner">
    <div>
      <div class="intro">
        <a class="logo" href="../../" aria-label="Steven Shen | 沈维燕 home page">
          <img src="https://ivc.bioinit.com/img/logo.png" alt="">
        </a>
        <p class="library-desc">
          
            Welcome to the personal website of Steven Shen.
          
        </p>
      </div>
      <nav id="patterns-nav" class="patterns" role="navigation">
        <h2 class="vh">Main navigation</h2>
        <button id="menu-button" aria-expanded="false">
          
          Menu
        </button>
        
        <ul id="patterns-list">
          
          <li class="pattern">
          
          
          
          
            <a href="../../" >
              
              首页
            </a>
          </li>
          
          <li class="pattern">
          
          
          
          
            <a href="../../about/" >
              
              关于
            </a>
          </li>
          
          <li class="pattern">
          
          
          
          
            <a href="../../blog/" >
              
              博客
            </a>
          </li>
          
          <li class="pattern">
          
          
          
          
            <a href="../../research/" >
              
              研究
            </a>
          </li>
          
          <li class="pattern">
          
          
          
          
            <a href="../../resume/shenweiyan" >
              
              简历
            </a>
          </li>
          
          <li class="pattern">
          
          
          
          
            <a href="../../tags/" >
              
              标签
            </a>
          </li>
          
          

<li class="pattern">&nbsp;&nbsp;</li>



<li class="pattern"><a href="https://github.com/shenweiyan/home/edit/master/content/blog/2019-07-01-r-gganatogram.md" target="_blank">编辑</a></li>


<li class="pattern"><a href="../../blog/index.xml" type="application/rss+xml" title="RSS feed">订阅</a></li>

<li class="pattern"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">版权</a></li>


        </ul>
      </nav>
    </div>
    </header>

    <article class="main">
      <header class="title">
        

<h1>基于 ggplot2 的解剖图和组织模块可视化</h1>



<h3>
2019-07-01</h3> 


   
  


      </header>




<p><a name="3ae14696"></a></p>

<h1 id="摘要">摘要</h1>

<p>将数据显示到解剖结构上，是一种可以快速观察组织相关信息的便捷技术。然而，绘制组织是一项复杂的任务（a complex task），需要解剖学和艺术方面的专业知识。虽然已经存在可用于在解剖图上显示基因表达的基于网络的应用技术，但是其他非遗传学科（non-genetic disciplines）缺乏类似的工具。此外，基于网络的工具通常缺乏与编程语言（如 R）中的包相关联的模块性（ lack the modularity associated with packages in programming languages）。这里我介绍 gganatogram，一个根据 ggplot2 的图形语法和来自 Expression Atlas 公众可用解剖图的组合，来绘制模块化物种解剖图的 R 包。这种组合允许快速，简单，模块化和可重复地生成解剖图。仅使用一个命令以及一个具有组织名称，分组，颜色和值的数据框，该工具就可以使用户能够以特定的颜色可视化特定的人体和小鼠组织，或者根据变量进行分组，或显示特定的值，例如基因-表达（gene-expression），药代动力学（pharmacokinetics）或所选组织之间的细菌负荷（bacterial load）。我希望这个工具对更广泛的生物科学界有用。也欢迎社区成员提交额外的解剖图，并将其纳入该软件包中。</p>

<p><a name="61a3ec66"></a></p>

<h1 id="介绍">介绍</h1>

<p>在多细胞生物中有效地显示组织信息可能是一个费力且耗时的过程（a laborious and time consuming process）。 研究人员通常希望展示值之间的差异，例如一个生物体组织之间，或不同组中具有相似组织之间的基因表达值或药代动力学值。</p>

<p>虽然条形图和热图提供了组间差异的信息视图，但很难立即观察到生物学意义（图 1a-b）。 与解剖图相比，后者更易于快速发现组织或组之间的差异，并可立即为这些观察提供生物学背景（biological context）（图 1c）。 这还有一个额外的好处，即无论是阅读论文还是参加讲座，观众都必须花费更少的时间和精力来掌握结果。<br /><img src="https://qiniu.bioinit.com/yuque/0/2018/png/126032/1541230221147-271d2842-2dd5-40fe-997c-a1cc038c4393.png#align=left&amp;display=inline&amp;height=725&amp;originHeight=965&amp;originWidth=994&amp;status=done&amp;width=747#align=left&amp;display=inline&amp;height=965&amp;originHeight=965&amp;originWidth=994&amp;status=done&amp;width=994" alt="" /><br />Figure 1. Comparison between barplot (top left), heatmap (top right), and anatogram (bottom) to display tissue values between groups.</p>

<p>已经存在几种在不同组织中显示基因表达的在线工具（如 Expression Atlas、Semantic Body Browser、TISSUES 2.0）。 虽然这些工具提供了关于各种组织和生物体中基因表达的重要信息，但除遗传学之外的其他学科由于(缺少)对基因的关注而无法利用这些应用（other disciplines besides genetics are unable to utilise these applications due to the focus on genes）。 此外，这些工具通常只包含一组可预测的预定义实验，导致难以呈现我们自己的数据。 还有其他值得注意是，使用这些工具，重建绘图或从结果中自动创建绘图可能很费力。</p>

<p>这里介绍的 gganatogram，是一个利用 Expression Atlas 中公开提供的鼠和人体解剖图，基于 ggplot2 的开源 R 软件包。 使用此软件包，任何 R 用户都可以轻松快速地查看具有指定颜色，组和值的解剖图。 使用 ggplot2 中熟悉的语法，该程序可用于模块化解剖图的生成。</p>

<p><a name="ea340b9d"></a></p>

<h1 id="方法">方法</h1>

<p><a name="5260945c"></a></p>

<h2 id="实现-implementation">实现（Implementation）</h2>

<p>gganatogram 存储在 <a href="https://neuroconductor.org/package/gganatogram">neuroconductor</a>，一个用于快速测试（rapid testing）和可重现计算成像软件（reproducible computational imaging software）传播的开源平台上， 其开发版本可以在 <a href="https://github.com/jespermaag/gganatogram">github/jespermaag/gganatogram</a> 找到，它允许社区通过创建坐标文件来发布包的 issues，提交请求或添加解剖图。</p>

<pre><code class="language-r">source(&quot;https://neuroconductor.org/neurocLite.R&quot;)
neuro_install(&quot;gganatogram&quot;, release = &quot;stable&quot;,
release_repo = latest_neuroc_release(release = &quot;stable&quot;))
</code></pre>

<p>开发版本可以从 github 安装：</p>

<pre><code class="language-r">devtools::install_github(&quot;jespermaag/gganatogram&quot;)
</code></pre>

<p>简而言之，为了生成包含所有组织坐标的主列表对象，作者从 Expression Atlas 下载了SVG文件（可从 <a href="https://github.com/ebi-gene-expression-group/anatomogram/tree/master/src/svg">gganatogram GitHub</a> 中获取）并使用自定义的 python 脚本（可从 <a href="https://github.com/jespermaag/gganatogram/blob/master/data-raw/getCoord.py">GitHub</a> 中获得）处理它们。 该脚本通过 SVG 文件来提取名称，坐标和 SVG 转换信息。 然后在 R 中对它们进行后处理以创建构成组织坐标的 rda 文件。</p>

<p><a name="9e15267f"></a></p>

<h2 id="操作-operation">操作（Operation）</h2>

<p>gganatogram 需要满足 R≥3.0.0，ggplot2 v.3.0.0 和 ggpolypath v.0.1.0 。 该程序应该能够在任何具有 R 系统要求的计算机上运行。可以使用包含器官名称，颜色，类型或值的基本 data.frame 生成图形。 根据 data.frame 的顺序，一次一个地绘制器官。 每个连续行的组织将在前一个上面分层。 gganatogram 包提供了四个这样的 data.frame，其中包含可用于绘图的所有组织，每个人和小鼠一个，并按性别划分。</p>

<pre><code class="language-r">hgMale_key, hgFemale_key, mmMale_key, mmFemale_key
</code></pre>

<p>这些数据框已经指定了颜色，类型和指定的随机数，以便于开始绘图。</p>

<pre><code class="language-r">head(hgFemale_key)
            organ  colour      type     value
1        pancreas  orange digestion 10.373146
2           liver  orange digestion 19.723172
3           colon  orange digestion 14.853335
4     bone_marrow #41ab5d     other 19.681587
5 urinary_bladder  orange digestion 14.914273
6         stomach  orange digestion  2.667599
</code></pre>

<p>主要功能是 gganatogram()。 默认情况下，没有任何参数，它会绘制具有标准 ggplot2 参数的男性人的轮廓。 通过添加几个选项，可以快速更改为女性，通过选定的颜色填充指定的器官，或者根据值填充器官（图2）。</p>

<pre><code class="language-r">library(gganatogram)
library(gridExtra)
organPlot &lt;- data.frame(organ = c(&quot;heart&quot;, &quot;leukocyte&quot;, &quot;nerve&quot;, &quot;brain&quot;, &quot;liver&quot;, &quot;stomach&quot;, &quot;colon&quot;),
    type = c(&quot;circulation&quot;, &quot;circulation&quot;, &quot;nervous␣system&quot;, &quot;nervous␣system&quot;, &quot;digestion&quot;, &quot;digestion&quot;, &quot;digestion&quot;),
    colour = c(&quot;red&quot;, &quot;red&quot;, &quot;purple&quot;, &quot;purple&quot;, &quot;orange&quot;, &quot;orange&quot;, &quot;orange&quot;),
    value = c(10, 5, 1, 8, 10, 5, 10),
    stringsAsFactors=F)

A &lt;- gganatogram()
B &lt;- gganatogram(fillOutline=&quot;#a6bddb&quot;, sex=&quot;female&quot;) + theme_void()
C &lt;- gganatogram(data=organPlot, fillOutline=&quot;#a6bddb&quot;, organism=&quot;human&quot;,
      sex=&quot;female&quot;, fill=&quot;colour&quot;)+ theme_void()
D &lt;- gganatogram(data=organPlot, fillOutline=&quot;#a6bddb&quot;, organism=&quot;human&quot;,
      sex=&quot;female&quot;, fill=&quot;value&quot;)+ theme_void()
grid.arrange(A, B, C, D, ncol=4)
</code></pre>

<p><img src="https://qiniu.bioinit.com/yuque/0/2018/png/126032/1541235122425-ea06fe8e-1a33-4c4b-989f-abb1137bfeaf.png#align=left&amp;display=inline&amp;height=251&amp;originHeight=335&amp;originWidth=998&amp;status=done&amp;width=747#align=left&amp;display=inline&amp;height=335&amp;originHeight=335&amp;originWidth=998&amp;status=done&amp;width=998" alt="" /><br />(A) Default plot generated by calling gganatogram(), (B) adding female, plotting specified organs by &copy; colour, (D) value.</p>

<p><a name="1a63ac23"></a></p>

<h1 id="示例">示例</h1>

<p>要绘制每个生物体的所有组织，请使用每个生物体和性别所提供的密钥文件。 这将按照每个 data frame 的顺序显示所有组织。 要更改器官彼此叠加的顺序，请重新排序数据框以使这些组织位于底部。</p>

<pre><code class="language-r">library(gganatogram)
library(gridExtra)
hgMale &lt;- gganatogram(data=hgMale_key, fillOutline=&quot;#a6bddb&quot;, organism=&quot;human&quot;,
           sex=&quot;male&quot;, fill=&quot;colour&quot;) + theme_void()

hgFemale &lt;- gganatogram(data=hgFemale_key, fillOutline=&quot;#a6bddb&quot;,
             organism=&quot;human&quot;, sex=&quot;female&quot;, fill=&quot;colour&quot;) + theme_void()

mmMale &lt;- gganatogram(data=mmMale_key, fillOutline=&quot;#a6bddb&quot;, organism=&quot;mouse&quot;,
           sex=&quot;male&quot;, fill=&quot;colour&quot;) + theme_void()

mmFemale &lt;- gganatogram(data=mmFemale_key, outline = T, fillOutline=&quot;#a6bddb&quot;,
             organism=&quot;mouse&quot;, sex=&quot;female&quot;, fill=&quot;colour&quot;) + theme_void()

grid.arrange(hgMale, hgFemale, mmMale, mmFemale, ncol=4)
</code></pre>

<p><img src="https://qiniu.bioinit.com/yuque/0/2018/png/126032/1541235847941-52d3c111-cb53-481a-be3f-bc1b93f03c55.png#align=left&amp;display=inline&amp;height=238&amp;originHeight=318&amp;originWidth=998&amp;status=done&amp;width=747#align=left&amp;display=inline&amp;height=318&amp;originHeight=318&amp;originWidth=998&amp;status=done&amp;width=998" alt="" /></p>

<pre><code class="language-r">hgMale &lt;- gganatogram(data=hgMale_key, fillOutline='#440154FF', organism='human', sex='male', fill=&quot;value&quot;) + theme_void() +  scale_fill_viridis()
hgFemale &lt;- gganatogram(data=hgFemale_key, fillOutline='#440154FF', organism='human', sex='female', fill=&quot;value&quot;) + theme_void() +  scale_fill_viridis()
mmMale &lt;- gganatogram(data=mmMale_key, fillOutline='#440154FF', organism='mouse', sex='male', fill=&quot;value&quot;) + theme_void() +  scale_fill_viridis()
mmFemale &lt;- gganatogram(data=mmFemale_key, outline = T, fillOutline='#440154FF', organism='mouse', sex='female', fill=&quot;value&quot;)  +theme_void()   +  scale_fill_viridis()

grid.arrange(hgMale, hgFemale, mmMale, mmFemale, ncol=2)
</code></pre>

<p><img src="https://qiniu.bioinit.com/yuque/0/2019/svg/126032/1558245234454-02d7e25b-d6c5-48f3-9282-e830154cd10d.svg#align=left&amp;display=inline&amp;height=480&amp;name=AllSpeciesPlotValue-1.svg&amp;originHeight=480&amp;originWidth=672&amp;size=2203107&amp;status=done&amp;width=672#align=left&amp;display=inline&amp;height=480&amp;originHeight=480&amp;originWidth=672&amp;status=done&amp;width=672" alt="AllSpeciesPlotValue-1.svg" /></p>

<p>要使用 gganatogram 函数，我们需要具有器官（organ）、颜色（colour）和相关值（value）的数据框（data frame）。</p>

<pre><code class="language-r">organPlot &lt;- data.frame(organ = c(&quot;heart&quot;, &quot;leukocyte&quot;, &quot;nerve&quot;, &quot;brain&quot;, &quot;liver&quot;, &quot;stomach&quot;, &quot;colon&quot;), 
 type = c(&quot;circulation&quot;, &quot;circulation&quot;,  &quot;nervous system&quot;, &quot;nervous system&quot;, &quot;digestion&quot;, &quot;digestion&quot;, &quot;digestion&quot;), 
 colour = c(&quot;red&quot;, &quot;red&quot;, &quot;purple&quot;, &quot;purple&quot;, &quot;orange&quot;, &quot;orange&quot;, &quot;orange&quot;), 
 value = c(10, 5, 1, 8, 2, 5, 5), 
 stringsAsFactors=F)

 head(organPlot)
#&gt;       organ           type colour value
#&gt; 1     heart    circulation    red    10
#&gt; 2 leukocyte    circulation    red     5
#&gt; 3     nerve nervous system purple     1
#&gt; 4     brain nervous system purple     8
#&gt; 5     liver      digestion orange     2
#&gt; 6   stomach      digestion orange     5
</code></pre>

<p>使用 gganatogram 函数，根据颜色填充器官。</p>

<pre><code class="language-r">gganatogram(data=organPlot, fillOutline='#a6bddb', organism='human', sex='male', fill=&quot;colour&quot;)
</code></pre>

<p><img src="https://qiniu.bioinit.com/yuque/0/2019/svg/126032/1558245599419-a8410c35-38ff-44bf-8cc9-54ef848f0b17.svg#align=left&amp;display=inline&amp;height=480&amp;name=1.svg&amp;originHeight=480&amp;originWidth=288&amp;size=265512&amp;status=done&amp;width=288#align=left&amp;display=inline&amp;height=480&amp;originHeight=480&amp;originWidth=288&amp;status=done&amp;width=288" alt="1.svg" /></p>

<p>当然，我们可以使用 ggplot 主题和函数来调整绘图。</p>

<pre><code class="language-r">gganatogram(data=organPlot, fillOutline='#a6bddb', organism='human', sex='male', fill=&quot;colour&quot;) + 
theme_void()
</code></pre>

<p><img src="https://qiniu.bioinit.com/yuque/0/2019/svg/126032/1558245728061-a6d666b7-edda-4811-8504-fd197622e61d.svg#align=left&amp;display=inline&amp;height=480&amp;name=2.svg&amp;originHeight=480&amp;originWidth=288&amp;size=240837&amp;status=done&amp;width=288#align=left&amp;display=inline&amp;height=480&amp;originHeight=480&amp;originWidth=288&amp;status=done&amp;width=288" alt="2.svg" /></p>

<p>我们也可以根据给予每个器官的值来填充各个组织的不同颜色；甚至，gganatogram 可以绘制细胞亚结构的相关组织图；或者是其他物种对应的解剖表达图谱。<br /><img src="https://qiniu.bioinit.com/yuque/0/2019/svg/126032/1558246311099-6a4b2f5e-e4fc-47d1-b757-1687eefd8ded.svg#align=left&amp;display=inline&amp;height=480&amp;name=4.svg&amp;originHeight=480&amp;originWidth=672&amp;size=556965&amp;status=done&amp;width=672#align=left&amp;display=inline&amp;height=480&amp;originHeight=480&amp;originWidth=672&amp;status=done&amp;width=672" alt="4.svg" /><br /><img src="https://qiniu.bioinit.com/yuque/0/2019/svg/126032/1558246269308-293c4c4b-20ad-4789-9ff5-9814398bfd8a.svg#align=left&amp;display=inline&amp;height=480&amp;name=3.svg&amp;originHeight=480&amp;originWidth=672&amp;size=285630&amp;status=done&amp;width=672#align=left&amp;display=inline&amp;height=480&amp;originHeight=480&amp;originWidth=672&amp;status=done&amp;width=672" alt="3.svg" /></p>

<p>更多 gganatogram 解剖图谱绘制示例可以参考其在 Github 的介绍，<a href="https://github.com/jespermaag/gganatogram">https://github.com/jespermaag/gganatogram</a>， 感兴趣的童鞋可以去尝试研究一下。</p>

<p>总的来说，gganatogram 是一款强大的 R 包，它可以根据 ggplot2 和 Expression Atlas 的信息轻松地显示解剖图，这些工具组合成了一个更加强大的工具来绘制和显示组织信息。</p>

<p><a name="35808e79"></a></p>

<h1 id="参考资料">参考资料</h1>

<ol>
<li>Maag JLV. <a href="https://f1000research.com/articles/7-1576/v1">gganatogram: An R package for modular visualisation of anatograms and tissues based on ggplot2</a> [version 1; referees: 1 approved]. F1000Research 2018, 7:1576 (doi: 10.12688/f1000research.16409.1)</li>
<li>Jesper Maag，<a href="https://github.com/jespermaag/gganatogram">Create anatograms using ggplot2</a>，Github</li>
</ol>

<p><img src="https://qiniu.bioinit.com/yuque/0/2019/png/126032/1559355228118-812c22f9-0dfc-4e51-ae2e-3c379150abd1.png#align=left&amp;display=inline&amp;height=500&amp;name=%E9%BB%98%E8%AE%A4%E6%A0%87%E9%A2%98_%E6%A8%AA%E7%89%88%E4%BA%8C%E7%BB%B4%E7%A0%81_2019.06.01.png&amp;originHeight=500&amp;originWidth=900&amp;size=67641&amp;status=done&amp;width=900" alt="默认标题_横版二维码_2019.06.01.png" /></p>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev"><a href="../../blog/2019-07-01-cloud-services-for-jupyter-notebook/">基于云的六大 Jupyter Notebook 平台测评</a><br/>&larr;</span>
  <span class="nav-next"><a href="../../blog/2019-07-01-webterminal-for-linux/">基于 Web 的 Linux 终端 WebTerminal</a><br/>&rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/blog\/2019-07-01-cloud-services-for-jupyter-notebook\/';
    
  } else if (e.which == 39) {  
    
    url = '\/blog\/2019-07-01-webterminal-for-linux\/';
    
  }
  if (url) window.location = url;
});
</script>



<section class="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
    this.page.url = "https:\/\/shenweiyan.github.io\/home\/" + location.pathname;
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//bioinit.disqus.com/embed.js';
    var d = document, s = d.createElement('script');
    s.src = disqus_js; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    var b = false, l = function() {
      if (b) return;
      (d.head || d.body).appendChild(s); b = true;
    }
    var t = d.getElementById('disqus_thread');
    s.onerror = function(e) {
      if (sessionStorage.getItem('failure-note')) return;
      t.innerText = '非常抱歉, 中国大陆地区读者需要翻墙才能发表评论。';
      t.style.border = '1px dashed';
      t.style.padding = '.5em';
      t.style.background = 'lightyellow';
      sessionStorage.setItem('failure-note', true);
    };
    
    if (location.hash.match(/^#comment/)) return l();
    var c = function() {
      if (b) return;
      var rect = t.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) l();
    };
    window.addEventListener('load', c);
    d.addEventListener('scroll', c);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>




<script async src="../../js/fix-toc.js"></script>

<script async src="../../js/center-img.js"></script>

<script async src="../../js/right-quote.js"></script>

<script async src="../../js/no-highlight.js"></script>

<script async src="../../js/fix-footnote.js"></script>

<script async src="../../js/math-code.js"></script>

<script async src="../../js/external-link.js"></script>

<script async src="../../js/alt-title.js"></script>

<script async src="../../js/header-link.js"></script>

<script async src="../../js/dom-scripts.js"></script>


<script async src="//cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>



  
  
  
  

  <script type="text/javascript" src="//rf.revolvermaps.com/0/0/6.js?i=5m6pzaeh5ar&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=0&amp;bv=0" async="async"></script>
  </footer>
  </article>
  
  </body>
</html>

